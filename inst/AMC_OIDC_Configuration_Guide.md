# AMC OpenID Connect Configuration Guide

## Overview

In this document we will describe the requirements and general instruction for setting up IBM Automation Mobile Capture (AMC) with an _OpenID Connect_ (_OIDC_) _Identity Provider_ (_IdP_).


## Requirements

- An OpenID Connect 1.0 Identity Provider
- _OIDC IdP_ must provide _Authentication Code with PKCE flow_ for authentication
- _OIDC IdP_ must support custom _Redirect URI_ scheme `imc://` configuration
- _OIDC IdP_ must include a claim, on its access token _JWT_, with the user's unique identifier
    - this can be the unique username, email or other unique identifier
    - this identifier will be visible to admin users within the admin console web page



## Instructions

### _OIDC IdP_ Instructions
1. Create a new _OIDC/OAuth app_
1. Configure app to support _Authentication Code with PKCE flow_
1. Add the following _URIs_ as allowed redirect _URIs_:
    - `https://<server host>/auth`, where `<server host>` is the host where the admin console web page is accessible at
    - `imc://auth`
    - `imc://logout`
1. Take note of the _IdP URL_. This is where the path `/.well-known/openid-configuration` is present
1. Take note of the _Client ID_ for the _OIDC/OAuth app_
1. Take note and/or configure, according to the _IdP_'s documentation, which _JWT_ claim contains the user's unique identifier
    - if documentation is not explicit, you may need to manually inspect a _JWT_ token generated by the _IdP_ and find the claim which contains the user's unique identifier. This is usually the username.
1. Take note if your _IdP_, according to the its documentation, requires the client to request additional _OIDC/OAuth_ scopes. This might be required in order to get access to a claim with the user's unique identifier


### AMC Instructions

Before deploying the _Helm Chart_, be it a new deployment or upgrade, perform the following changes on the `values.yaml` _Helm Chart_ configuration file:

```yaml
authentication: 
  externalOIDC:
    providerUrl: '<IdP URL>'
    clientId: '<Client ID>'
    additionalScope: '<additional scopes>'
    usernameClaim: '<unique identifier claim>'
    additionalRedirectUrls: ''
```
where:
- `<IdP URL>` is the _OIDC IdP_'s _URL_, previously taken on point _4._. (i.e. _https://oidc.example.com_)
- `<Client ID>` is the _OIDC/OAuth Client ID_, previously taken on point _5._.
- `<additional scopes>` are the additional scopes to be requested by clients, as previously taken on point _7._. If more than one scope is required, provide them separeted by a single space.
- `<unique identifier claim>` is the name of the _JWT_ claim that contains the user's unique identifier, as previously taken on point _6._.
